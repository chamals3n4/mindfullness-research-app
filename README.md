setup

1. clone the repo
   ```bash
   git clone <repo-url>
   cd mindfulness-research-app/app
   ```

2. install dependencies
   ```bash
   npm install
   ```

3. setup environment variables
   create a `.env` file in the `app/` folder with the following keys:

   ```env
   EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
   EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
   EXPO_PUBLIC_R2_ACCOUNT_ID=your_cloudflare_account_id
   EXPO_PUBLIC_R2_ACCESS_KEY_ID=your_r2_access_key
   EXPO_PUBLIC_R2_SECRET_ACCESS_KEY=your_r2_secret_key
   EXPO_PUBLIC_R2_BUCKET_NAME=your_bucket_name
   EXPO_PUBLIC_R2_PUBLIC_URL=your_r2_public_dev_url
   ```

4. run the app
   ```bash
   npm start
   ```

supabase setup

1. create project
   go to supabase.com and create a new project.

2. database schema
   go to the sql editor and run this query to create tables:

   ```sql
   -- profiles table
   create table profiles (
     id uuid references auth.users on delete cascade not null primary key,
     updated_at timestamp with time zone,
     username text,
     website text,
     avatar_url text
   );
   alter table profiles disable row level security;

   -- daily entries table
   create table daily_entries (
     id bigint generated by default as identity primary key,
     user_id uuid references auth.users not null,
     created_at timestamp with time zone default timezone('utc'::text, now()) not null,
     entry_date date not null,
     name text not null,
     description text,
     media_url text,
     media_type text
   );
   alter table daily_entries disable row level security;

   -- auto-create profile trigger
   create or replace function public.handle_new_user()
   returns trigger as $$
   begin
     insert into public.profiles (id) values (new.id);
     return new;
   end;
   $$ language plpgsql security definer;

   create or replace trigger on_auth_user_created
     after insert on auth.users
     for each row execute procedure public.handle_new_user();
   ```

3. create user
   go to authentication > users > add user to create a test account.

cloudflare r2 setup

1. create bucket
   go to cloudflare dashboard > r2 > create bucket.
   give it a name (e.g., research). this is your `EXPO_PUBLIC_R2_BUCKET_NAME`.

2. enable public access
   click on your bucket > settings > public access.
   enable "r2.dev subdomain".
   copy the url (https://pub-xxx.r2.dev). this is your `EXPO_PUBLIC_R2_PUBLIC_URL`.

3. get api keys
   go to r2 main page > manage r2 api tokens > create api token.
   permissions: object read & write.
   ttl: forever.
   click create.
   copy:
   - access key id -> `EXPO_PUBLIC_R2_ACCESS_KEY_ID`
   - secret access key -> `EXPO_PUBLIC_R2_SECRET_ACCESS_KEY`

4. get account id
   go to r2 main page.
   look at the right sidebar for "account id".
   copy it -> `EXPO_PUBLIC_R2_ACCOUNT_ID`.

5. configure cors (crucial for app uploads)
   go to your bucket > settings > cors policy.
   add this json:
   ```json
   [
     {
       "AllowedOrigins": ["*"],
       "AllowedMethods": ["PUT", "GET", "POST", "HEAD"],
       "AllowedHeaders": ["*"],
       "ExposeHeaders": []
     }
   ]
   ```
